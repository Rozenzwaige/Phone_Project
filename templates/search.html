{% extends "base.html" %}
{% block title %}חיפוש{% endblock %}

{% block content %}
  <style>
    body { text-align: center; font-family: Arial, sans-serif; direction: rtl; background-color: #fff; }
    .container { max-width: 900px; margin: auto; padding: 20px; }

    .search-box {
      position: sticky; top: 0; z-index: 10;
      width: 100%; background: #f0f0f0; padding: 12px; border-radius: 8px;
      display: flex; justify-content: center; align-items: center; gap: 10px;
      margin-bottom: 10px;
    }

    select, input, button { font-size: 16px; border: none; outline: none; background: none; }
    input[type="text"] { width: 100%; padding: 10px; background: white; border-radius: 8px; }
    button { cursor: pointer; padding: 10px 15px; }

    /* אזור תוצאות עם גלילה פנימית */
    .results-scroll {
      max-height: calc(100vh - 180px);  /* אם צריך, שחק עם המספר כדי שישב טוב על המסך שלך */
      overflow: auto;
      border: 1px solid #eee;
      border-radius: 8px;
    }

    table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    th, td {
      padding: 8px;
      text-align: right;
      white-space: normal;
      word-wrap: break-word;
      overflow-wrap: anywhere;
      border-bottom: 1px solid #eee;
    }

    /* כותרות העמודות – קפואות בזמן גלילה */
    thead th {
      position: sticky;
      top: 0;                 /* נדבקות לראש המכל הגולל */
      background: #fafafa;
      z-index: 2;
    }

    /* רוחבים קבועים */
    .col-name  { width: 15ch; }
    .col-phone { width: 15ch; }
    .col-title { width: auto; }
  </style>

  <div class="container">

    <div class="search-header">
      <h1 style="margin:0 0 12px;">חיפוש במאגר אנשי קשר</h1>

      <form action="{{ url_for('search') }}" method="GET" class="search-box">
        <select name="search_type">
          <option value="free"  {{ 'selected' if search_type=='free'  else '' }}>חיפוש חופשי</option>
          <option value="name"  {{ 'selected' if search_type=='name'  else '' }}>שם</option>
          <option value="title" {{ 'selected' if search_type=='title' else '' }}>טייטל</option>
        </select>

        <input type="text" name="query" value="{{ query or '' }}" placeholder="מה תרצה לחפש?">
        <button type="submit">חפש</button>
      </form>

      {% if rows is defined and query %}
        <div style="margin-top:8px;">
          <small>תוצאות עבור: <strong>{{ query }}</strong></small>
        </div>
      {% endif %}
    </div>

    {% if rows is defined %}
      {% if rows %}
        <div class="results-scroll">
          <table>
            <thead>
              <tr>
                <th class="col-name">שם</th>
                <th class="col-title">טייטל</th>
                <th class="col-phone">טלפון</th>
              </tr>
            </thead>
            <tbody>
              {% for r in rows %}
                <tr>
                  <td class="col-name">{{ r.name or r.get('name') or '' }}</td>
                  <td class="col-title">{{ r.title or r.get('title') or '' }}</td>
                  <td class="col-phone">{{ r.phone or r.get('phone') or '' }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p style="margin-top:16px;">לא נמצאו תוצאות.</p>
      {% endif %}
    {% endif %}

  </div>
{% endblock %}
